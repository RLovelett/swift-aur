From 04da81179bd7bd4e19e048fd60d446b57d5c7882 Mon Sep 17 00:00:00 2001
From: Ryan Lovelett <ryan@lovelett.me>
Date: Sun, 3 Jan 2016 10:37:57 -0500
Subject: [PATCH] Make it work on Python 2 and 3

---
 configure        |  2 +-
 lib/config.py    |  5 ++++-
 lib/phases.py    | 15 ++++++++++++---
 lib/product.py   | 40 ++++++++++++++++++++++++++++++++--------
 lib/script.py    |  7 +++++--
 lib/target.py    |  5 ++++-
 lib/workspace.py | 14 ++++++++++----
 7 files changed, 68 insertions(+), 20 deletions(-)

diff --git a/configure b/configure
index 23edb6b..dd99134 100755
--- a/configure
+++ b/configure
@@ -175,7 +175,7 @@ def main():
     config.write(config.config_path.absolute())
     Configuration.current = config
 
-    execfile(config.script_path.absolute())
+    exec(compile(open(config.script_path.absolute()).read(), config.script_path.absolute(), 'exec'))
 
 
 if __name__ == "__main__":
diff --git a/lib/config.py b/lib/config.py
index 895bac7..ca675d3 100644
--- a/lib/config.py
+++ b/lib/config.py
@@ -9,7 +9,10 @@
 
 import json
 
-from path import Path
+try:
+    from path import Path
+except ImportError:
+    from .path import Path
 
 class Configuration:
     Debug = "debug"
diff --git a/lib/phases.py b/lib/phases.py
index e212bdd..ce46264 100644
--- a/lib/phases.py
+++ b/lib/phases.py
@@ -7,9 +7,18 @@
 # See http://swift.org/CONTRIBUTORS.txt for the list of Swift project authors
 #
 
-from config import Configuration
-from target import TargetConditional
-from path import Path
+try:
+    from config import Configuration
+except ImportError:
+    from .config import Configuration
+try:
+    from target import TargetConditional
+except ImportError:
+    from .target import TargetConditional
+try:
+    from path import Path
+except ImportError:
+    from .path import Path
 import os
 
 class BuildAction:
diff --git a/lib/product.py b/lib/product.py
index 82684cc..1885adc 100644
--- a/lib/product.py
+++ b/lib/product.py
@@ -7,14 +7,38 @@
 # See http://swift.org/CONTRIBUTORS.txt for the list of Swift project authors
 #
 
-from config import Configuration
-from phases import CompileC
-from phases import CompileCxx
-from phases import Assemble
-from phases import BuildAction
-from phases import MergeSwiftModule
-from target import OSType
-from path import Path
+try:
+    from config import Configuration
+except ImportError:
+    from .config import Configuration
+try:
+    from phases import CompileC
+except ImportError:
+    from .phases import CompileC
+try:
+    from phases import CompileCxx
+except ImportError:
+    from .phases import CompileCxx
+try:
+    from phases import Assemble
+except ImportError:
+    from .phases import Assemble
+try:
+    from phases import BuildAction
+except ImportError:
+    from .phases import BuildAction
+try:
+    from phases import MergeSwiftModule
+except ImportError:
+    from .phases import MergeSwiftModule
+try:
+    from target import OSType
+except ImportError:
+    from .target import OSType
+try:
+    from path import Path
+except ImportError:
+    from .path import Path
 
 import os
 
diff --git a/lib/script.py b/lib/script.py
index 5a5fe2f..05224a7 100644
--- a/lib/script.py
+++ b/lib/script.py
@@ -7,7 +7,10 @@
 # See http://swift.org/CONTRIBUTORS.txt for the list of Swift project authors
 #
 
-from config import Configuration
+try:
+    from config import Configuration
+except ImportError:
+    from .config import Configuration
 import os
 
 class Script:
@@ -31,7 +34,7 @@ class Script:
 
     def generate_products(self):
         variables = ""
-        for key, val in Configuration.current.variables.iteritems():
+        for key, val in Configuration.current.variables.items():
             variables += key + "=" + val
         variables += "\n"
         verbose_flags = """
diff --git a/lib/target.py b/lib/target.py
index cd96f1e..ceb4c2d 100644
--- a/lib/target.py
+++ b/lib/target.py
@@ -7,7 +7,10 @@
 # See http://swift.org/CONTRIBUTORS.txt for the list of Swift project authors
 #
 
-from config import Configuration
+try:
+    from config import Configuration
+except ImportError:
+    from .config import Configuration
 import platform
 
 class ArchType:
diff --git a/lib/workspace.py b/lib/workspace.py
index 73bf5dd..976717a 100644
--- a/lib/workspace.py
+++ b/lib/workspace.py
@@ -8,8 +8,14 @@
 #
 
 from subprocess import call
-from config import Configuration
-from path import Path
+try:
+    from config import Configuration
+except ImportError:
+    from .config import Configuration
+try:
+    from path import Path
+except ImportError:
+    from .path import Path
 import os
 
 class Workspace:
@@ -36,8 +42,8 @@ class Workspace:
 
             if Configuration.current.verbose:
                 cmd.append("--verbose")
-                print "cd " + working_dir
-                print "    " + " ".join(cmd)
+                print("cd " + working_dir)
+                print("    " + " ".join(cmd))
             status = call(cmd, cwd=working_dir)
             if status != 0:
                 exit(status) # pass the exit value along if one of the sub-configurations fails
-- 
2.6.4

